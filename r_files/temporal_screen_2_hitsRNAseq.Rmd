---
title: "Screen hits KO RNAseq"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# RNA analysis
Analysis after nf-core/rnaseq 3.5

```{r message=FALSE}

rm(list=ls())

library(DESeq2)
library(RColorBrewer)
library(tidyverse)
library(ComplexHeatmap)
library(tximport)
library(UpSetR)
library(colorspace)
library(circlize)

```

### Load settings

Colors, main directory 

```{r}

source('./r_inputs/TemporalSpatialNeuralTube_settings.R')

```


### Set dirs
```{r}

subworkinput="inputs_glialScreen_3/"

outdir="outputs_glialScreen_3_3_diffexpress/"
ifelse(!dir.exists(file.path(workingdir,outdir)), dir.create(file.path(workingdir,outdir)), "Directory exists")



```


## Load data

I am using the output of star_salmon so the import to deseq is a bit more complicated.

```{r }


#salmon counts from pipeline, import
path_files =  list.files(paste0(workingdir,subworkinput)) 
samples = data.frame(run=path_files, stringsAsFactors = FALSE) %>%
  filter(str_detect(run, "D"))

files <- file.path(paste0(workingdir,subworkinput), samples$run, "quant.sf")
names(files) <- samples$run
all(file.exists(files))

#from pipeline
tx2gene = read_tsv(paste0(paste0(workingdir,subworkinput),"/salmon_tx2gene.tsv"))

txi.salmon <- tximport(files, type = "salmon", tx2gene = tx2gene)
#head(txi.salmon$counts)

count.table <- txi.salmon$counts

```

import tables: counts for this validation RNAseq

```{r}

# dds_counts <- read.table(paste0(workingdir,"outputs_glialScreen_3/","featurecounts.normCounts.txt"),stringsAsFactors =FALSE)


```


vsd of CaTS-RNA for heatmaps

```{r}

count_vsd <- read.csv(file=paste0(workingdir,"outputs_glialRNA_1/","featurecounts.vsd.csv"),header=TRUE, stringsAsFactors = FALSE)

```

counts of CaTS-RNA for thresholding 

```{r}

count_cats <- read.table(file=paste0(workingdir,"outputs_glialRNA_1/","featurecounts.normCounts.txt"),header=TRUE, stringsAsFactors = FALSE)

```

## Colors and shapes
Before more plotting, let's get some metadata organised

```{r }

# 
# geneKO <- c("NT","Eed","Ezh2","Brd8","Rxra","Atf3","Nr6a1")
# metaKOs <- data.frame(GeneKO=geneKO, hit_type=c("Control",rep("Pos_regulator",4),rep("Neg_regulator",2)))
# colorKOs <- c("#b7b7b7","#ff2e0e","#ff6149","#FF8370","#ffb6ab","#00d8a1","#007658")
# 
# shapes4_manual = c(18,15,16,17) # these are block
# shapes5_manual = c(25,21,22,23,24) # these are filled
# shapes4_fill_manual = c(23,21,22,24)
# 
# sorted_DayGate <- c("D5_p1","D5_p2","D5_pM",
#                     "D7_p1","D7_p2","D7_pM",
#                     "D9_p1","D9_p2","D9_pM",
#                     "D11_p1","D11_p2","D11_pM")
# 
# sorted_WTDayGate <- paste("WT",sorted_DayGate, sep="_")

```


## Differential analysis

```{r}

#matrix
count_matrix <- count.table %>%
  as.data.frame()

#this is for uploading to GEO
write.table(count_matrix,
      file = paste0(workingdir,outdir,"CountsRaw_all.txt"), quote = FALSE)


#subset 
timepoint=c("D07_","D09_","D11_")
#matrix
comparisons=matrix(c(rep("NT",4),"Eed","Ezh2","Brd8","Nr6a1"),
                 nrow=4,
                 ncol=2)


PairWiseDEseq <- lapply(c(1:length(timepoint)),function (x) {
  lapply(c(1:nrow(comparisons)), function (y) {
      timepoints <- timepoint[x]
      subKO <- comparisons[y,]
      sub_counts <- count_matrix %>%
        dplyr::select(contains(subKO) & contains(timepoints))
      
      ## Make metadata file for DESeq
      genecolData_sub <- data.frame(Sample_ID = colnames(sub_counts))
      genecolData_sub <- genecolData_sub %>% 
          separate(Sample_ID,into=c("Day","GeneKO","Rep"), sep="_", remove=FALSE)
      genecolData_sub <- as.data.frame(unclass(genecolData_sub))
      
      
      dds_sub <- DESeqDataSetFromMatrix(countData =  round(sub_counts),
                              colData = genecolData_sub,
                              design = ~ GeneKO)
          
      dds_sub$GeneKO <- factor(dds_sub$GeneKO, levels = subKO)
      
      dds_sub <- DESeq(dds_sub)
      
      vsd_sub <- varianceStabilizingTransformation(dds_sub,blind = FALSE)
      
      # Export normalized tables for plotting elsewhere
      dds_sub_counts <- counts(dds_sub, normalized = TRUE)
      vsd_sub_data <- assay(vsd_sub)
      
      results_sub <- results(dds_sub)

      # plotMA(results_sub,ylim=c(-8,8))

      ## Export files
      
      write.table(dds_sub_counts,
      file = paste0(workingdir,outdir,"CountsNormalized_",timepoints,resultsNames(dds_sub)[2],".txt"),
          quote = FALSE, row.names = TRUE)
      write.csv(vsd_sub_data,
          paste0(workingdir,outdir,"VSData_",timepoints,resultsNames(dds_sub)[2],".csv"),
          quote = FALSE)
      write.table(results_sub,
          file = paste0(workingdir,outdir,"Results_DESeq_",timepoints,resultsNames(dds_sub)[2],".txt"),
          quote = FALSE, row.names = TRUE)

      results_return <- results_sub %>% as.data.frame() %>% rownames_to_column("Geneid")
      results_return$Comparison <- paste0("Comp_",timepoints,resultsNames(dds_sub)[2])
      results_return

  })
}) 

```


### Thresholds for Mutant vs Control comparisons

Based on exploring the data, we have chosen:

`filter(padj < 0.05 & abs(log2FoldChange) > 1 & baseMean > 80)`

```{r}
adjusted_pval = 0.05

log2FC = 1

minBaseMean = 80
```


```{r}

list_allcomparisons <- unlist(PairWiseDEseq,recursive=FALSE)
results_deseq <- do.call(rbind,list_allcomparisons)

top_comparisons <- results_deseq %>%
  as.data.frame() %>%
  filter(padj < adjusted_pval & abs(log2FoldChange) > log2FC & baseMean > minBaseMean)

 

```

Print list

```{r}

write.csv(top_comparisons, file = paste0(workingdir,outdir,"Top_filtered_Results_DESeq2.csv"), quote = FALSE, row.names = FALSE)

```



# Systematic explorarion of each candidate


Plot usual expression of CaTS ATAC heatmap side by side with log2FC in KO

For each KO, just plot the affected genes

```{r fig.height=12, fig.width=12}

top_comparisons_prep <- top_comparisons %>%
  separate(Comparison, into = c("constantComp","Day","constantGeneKO","GeneKO","constantvs","constantNT"), remove = FALSE) %>%
  dplyr::select(-starts_with("constant"))


KOvector <- top_comparisons_prep$GeneKO %>% unique()

ht_RNA_KOfoldchange <- lapply(c(1:length(KOvector)),function (x) {
          whichKO <- KOvector[x]
          sub_topcomparisons <- top_comparisons_prep %>% filter(GeneKO==whichKO)
          
          
          
          # make a heatmap of CaTS-RNA: this heatmap filters rows of genes with sd zero
          # filter genes
          vsd_hm <- count_vsd %>%
            filter(X %in% sub_topcomparisons$Geneid) %>%
            column_to_rownames("X") %>%
            dplyr::select(starts_with("WT"))
          
          dim(vsd_hm)
          
          vsd_hm_z1 <- t(scale(t(vsd_hm))) 
          nonzero = rowSds(vsd_hm_z1, useNames = TRUE) %>% as.data.frame() %>% rownames_to_column("geneid")
          colnames(nonzero) = c("geneid","calculated_rowsds")
          nonzero_filtered = nonzero %>% filter(calculated_rowsds != 0) %>% dplyr::select(geneid)
          vsd_hm_z <- vsd_hm_z1[nonzero_filtered$geneid,]
          
          # metadata for the heatmap
          genecolData_first <- data.frame(Sample_ID = colnames(vsd_hm_z1))
          genecolData_first <- genecolData_first %>% 
            separate(Sample_ID,into=c("Genotype","Day","Gate","NFIAgate","Rep"), sep="_", remove=FALSE) %>%
            mutate(Condition=paste(Genotype,Day,Gate,NFIAgate, sep="_"),
                   DayNFIA=paste(Day,NFIAgate,Genotype,sep = "_"),
                   DayGate=paste(Day,Gate,sep="_"),
                   Experiment=paste(Genotype,Rep,sep="_"),
                   NFIAstatus=paste(NFIAgate,Genotype,sep="_"))
          genecolData_first <- as.data.frame(unclass(genecolData_first))
          
          phen_data <- genecolData_first %>%
            dplyr::select(c("Sample_ID","DayGate","Day","NFIAstatus","Rep")) %>%
            remove_rownames() %>%
            column_to_rownames("Sample_ID")
          
          ann_color_JD <- list(
            DayGate = c(D5_p1="#abdff4",D5_p2="#f1df9a", D5_pM="#f19aac",
                        D7_p1="#55bee8",D7_p2="#e6c444",D7_pM="#e64466",
                        D9_p1="#1a91c1",D9_p2="#c19e1a",D9_pM="#c11a3d",
                        D11_p1="#0e506b",D11_p2="#6b570e",D11_pM="#7c1127"),
            NFIAstatus = c(NFIAn_WT="#f6f6f6",NFIAp_WT="#cecece",`100`="#808080",NFIAn_MUT="#595959"),
            Day = c(D5="#fadede",D7="#f3aaaa",D9="#e96666",D11="#cf1e1e"),
            Rep = c(R1="#ebeb77", R2="#77b1eb", R3="#eb7777"))
          
          # Build the annotation for the complex heatmap
          colAnn <- HeatmapAnnotation(
              df = phen_data,
              which = 'col', # 'col' (samples) or 'row' (gene) annotation?
              na_col = 'white', # default colour for any NA values in the annotation data-frame, 'ann'
              col = ann_color_JD,
              annotation_height = 0.6,
              annotation_width = unit(1, 'cm'),
              gap = unit(1, 'mm'))

          # Annotated heatmap with dplyr::selected colors
          hm_colors = colorRampPalette(rev(brewer.pal(n = 11, name = "RdBu")))(100)
            
          hmap_catsRNA <- Heatmap(vsd_hm_z,
          
              name = 'Z-score',
          
              col = hm_colors,
          
              # row (gene) parameters
                cluster_rows = TRUE,
                show_row_dend = TRUE,
                #row_title = 'Statistically significant genes',
                row_title_side = 'left',
                row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
                row_title_rot = 90,
                show_row_names = TRUE,
                row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
                row_names_side = 'left',
                row_dend_width = unit(25,'mm'),
          
              # column (sample) parameters
                cluster_columns = TRUE,
                show_column_dend = TRUE,
                column_title = '',
                column_title_side = 'bottom',
                column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
                column_title_rot = 0,
                show_column_names = TRUE,
                column_names_gp = gpar(fontsize = 8),
                column_names_max_height = unit(10, 'cm'),
                column_dend_height = unit(25,'mm'),
          
              # cluster methods for rows and columns
                clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
                clustering_method_columns = 'ward.D2',
                clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
                clustering_method_rows = 'ward.D2',
          
              # specify top and bottom annotations
                top_annotation = colAnn)
          
          
              ## subset to make a heatmap of log2FC
              sub_log2fc <- sub_topcomparisons %>% dplyr::select(Geneid,log2FoldChange, Day) %>%
                pivot_wider(values_from = log2FoldChange, names_from = Day) # this table has 3 columns for the three days with NAs for those genes that are significant at a particular timepoint 
              log2fc_matrix_full <- sub_log2fc %>% column_to_rownames("Geneid")
              log2fc_matrix_catsfiltered <- log2fc_matrix_full[nonzero_filtered$geneid,]
                
              # make a heatmap of log2FC        
              hmap_foldchange <- Heatmap(log2fc_matrix_catsfiltered,
                  name = paste0('log 2 fold change KO: ', whichKO),
                  #col = hm_colors,
                  # row (gene) parameters
                    cluster_rows = FALSE,
                    show_row_dend = TRUE,
                    #row_title = 'Statistically significant genes',
                    row_title_side = 'left',
                    row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
                    row_title_rot = 90,
                    show_row_names = TRUE,
                    row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
                    row_names_side = 'left',
                    row_dend_width = unit(25,'mm'),
              
                  # column (sample) parameters
                    cluster_columns = FALSE,
                    show_column_dend = TRUE,
                    column_title = '',
                    column_title_side = 'bottom',
                    column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
                    column_title_rot = 0,
                    show_column_names = TRUE,
                    column_names_gp = gpar(fontsize = 8),
                    column_names_max_height = unit(10, 'cm'),
                    column_dend_height = unit(25,'mm'),
              
                  # cluster methods for rows and columns
                    clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
                    clustering_method_columns = 'ward.D2',
                    clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
                    clustering_method_rows = 'ward.D2')
   
          # draw(hmap_catsRNA + hmap_foldchange,
          #     heatmap_legend_side = 'left',
          #     annotation_legend_side = 'left',
          #     row_sub_title_side = 'left')    
          
          # print heatmap
          pdf(paste0(workingdir,outdir,"Heatmap_geneKO_",whichKO,".pdf"), width = 15, height = 20) 

          draw(hmap_catsRNA + hmap_foldchange,
              heatmap_legend_side = 'left',
              annotation_legend_side = 'left',
              row_sub_title_side = 'left')

          dev.off()

  
})



```




## Fig: polycomb + Brd8

- Beyond just NFIA: Polycomb + Brd8 promote temporal progression, e.g. 
  - Bars: other hits in the screen
  - Heatmap: all temporal genes
- But they are changing the DV identity of the neural progenitors


#### Hits in the screen 

```{r fig.height=5, fig.width=7}

geneOI <- c("E2f7","Foxb1","Sox6","Rfx4","Nfia")


```

### Temporal genes 
which ones are affected by Eed, Ezh2 and Brd8?

first plot the dependent genes

the heatmap with just average by condition for the original cats-rna

```{r fig.height=6, fig.width=8}


top_comparisons_prep_multi <- top_comparisons_prep %>% 
  mutate(GeneKO_day=paste(GeneKO, Day, sep="_")) %>%
  filter(GeneKO %in% c("Eed","Ezh2","Brd8"))

## make averages by condition

count_vsd_ave <- count_vsd %>%
  pivot_longer(values_to = "vsd", names_to = "sampleid", MUT_D11_p1_NFIAn_R2:WT_D9_pM_NFIAp_R3) %>%
  separate(sampleid, into = c("geno","day","gate","nfia","rep")) %>%
  mutate(condition=paste(geno,day,gate, sep="_")) %>%
  group_by(X,condition) %>%
  summarise(vsd_ave=mean(vsd)) %>%
  pivot_wider(values_from = vsd_ave, names_from = condition)


```


Now all temporal genes! 
```{r fig.height=6, fig.width=6.5}


top_comparisons_prep_multi <- top_comparisons_prep %>% 
  mutate(GeneKO_day=paste(GeneKO, Day, sep="_")) %>%
  filter(GeneKO %in% c("Eed","Ezh2","Brd8"))

tempALL_genes <- read.csv(file=paste0(workingdir,"outputs_glialrna_2_time_space/","Genes_temporal_alldomains.csv"), header = TRUE, stringsAsFactors = FALSE)


# make a heatmap of CaTS-RNA: this heatmap filters rows of genes with sd zero
# using average values
# filter genes
vsd_hm <- count_vsd_ave %>%
  filter(X %in% tempALL_genes$GeneID) %>%
  column_to_rownames("X") %>%
  dplyr::select(starts_with("WT"))

dim(vsd_hm)

vsd_hm_z <- t(scale(t(vsd_hm))) 

# metadata for the heatmap
genecolData_first <- data.frame(Sample_ID = colnames(vsd_hm_z))
genecolData_first <- genecolData_first %>% 
  separate(Sample_ID,into=c("Genotype","Day","Gate"), sep="_", remove=FALSE) %>%
  mutate(DayGate=paste(Day,Gate,sep="_"))
genecolData_first <- as.data.frame(unclass(genecolData_first))

phen_data <- genecolData_first %>%
  dplyr::select(c("Sample_ID","DayGate","Day")) %>%
  remove_rownames() %>%
  column_to_rownames("Sample_ID")

ann_color_JD <- list(
  DayGate = c(D5_p1="#abdff4",D5_p2="#f1df9a", D5_pM="#f19aac",
              D7_p1="#55bee8",D7_p2="#e6c444",D7_pM="#e64466",
              D9_p1="#1a91c1",D9_p2="#c19e1a",D9_pM="#c11a3d",
              D11_p1="#0e506b",D11_p2="#6b570e",D11_pM="#7c1127"),
  NFIAstatus = c(NFIAn_WT="#f6f6f6",NFIAp_WT="#cecece",`100`="#808080",NFIAn_MUT="#595959"),
  Day = c(D5="#fadede",D7="#f3aaaa",D9="#e96666",D11="#cf1e1e"),
  Rep = c(R1="#ebeb77", R2="#77b1eb", R3="#eb7777"))

# Build the annotation for the complex heatmap
colAnn <- HeatmapAnnotation(
    df = phen_data,
    which = 'col', # 'col' (samples) or 'row' (gene) annotation?
    na_col = 'white', # default colour for any NA values in the annotation data-frame, 'ann'
    col = ann_color_JD,
    annotation_height = 0.6,
    annotation_width = unit(1, 'cm'),
    gap = unit(1, 'mm'))

# Annotated heatmap with dplyr::selected colors
hm_colors = colorRampPalette(rev(brewer.pal(n = 11, name = "RdBu")))(100)

set.seed(123)  #For reproduciblity

hmap_catsRNA <- Heatmap(vsd_hm_z,
    use_raster = TRUE, 
    km=6,
    name = 'Z-score',

    col = hm_colors,

    # row (gene) parameters
      cluster_rows = TRUE,
      show_row_dend = TRUE,
      #row_title = 'Statistically significant genes',
      row_title_side = 'left',
      row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
      row_title_rot = 90,
      show_row_names = FALSE,
      row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
      row_names_side = 'left',
      row_dend_width = unit(25,'mm'),

    # column (sample) parameters
      cluster_columns = TRUE,
      show_column_dend = TRUE,
      column_title = '',
      column_title_side = 'bottom',
      column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
      column_title_rot = 0,
      show_column_names = FALSE,
      column_names_gp = gpar(fontsize = 8),
      column_names_max_height = unit(10, 'cm'),
      column_dend_height = unit(25,'mm'),

    # cluster methods for rows and columns
      clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
      clustering_method_columns = 'ward.D2',
      clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
      clustering_method_rows = 'ward.D2',

    # specify top and bottom annotations
      top_annotation = colAnn)


    ## subset to make a heatmap of log2FC: there will be genes with NA throughout 
  sub_log2fc <- top_comparisons_prep_multi %>% dplyr::select(Geneid,log2FoldChange, GeneKO_day) %>%
      pivot_wider(values_from = log2FoldChange, names_from = GeneKO_day) # this table has 3 columns for the three days with NAs for those genes that are significant at a particular timepoint   

  expanded_log2fc <- vsd_hm %>% rownames_to_column("Geneid") %>%
    dplyr::select("Geneid") %>%
    left_join(sub_log2fc, by="Geneid") %>% 
    column_to_rownames("Geneid")
  #row order
    log2fc_matrix_catsfiltered <- expanded_log2fc[rownames(vsd_hm),]
    log2fc_matrix_catsfiltered <- as.matrix(log2fc_matrix_catsfiltered)
      
    # make a heatmap of log2FC        
    hmap_foldchange <- Heatmap(log2fc_matrix_catsfiltered,
        name = 'log 2 fold change KO: Eed,Ezh2,Brd8',
        #col = hm_colors,
        # row (gene) parameters
          cluster_rows = FALSE,
          show_row_dend = TRUE,
          #row_title = 'Statistically significant genes',
          row_title_side = 'left',
          row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
          row_title_rot = 90,
          show_row_names = FALSE,
          row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
          row_names_side = 'left',
          row_dend_width = unit(25,'mm'),
    
        # column (sample) parameters
          cluster_columns = FALSE,
          show_column_dend = TRUE,
          column_title = '',
          column_title_side = 'bottom',
          column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
          column_title_rot = 0,
          show_column_names = TRUE,
          column_names_gp = gpar(fontsize = 8),
          column_names_max_height = unit(10, 'cm'),
          column_dend_height = unit(25,'mm'),
    
        # cluster methods for rows and columns
          clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
          clustering_method_columns = 'ward.D2',
          clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
          clustering_method_rows = 'ward.D2')

draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')    

# print heatmap
pdf(paste0(workingdir,outdir,"Heatmap_ALLtempgenes_PRC_Brd8.pdf"), width = 7, height = 6) 

draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')

dev.off()




```





### D-V markers

```{r fig.height=4, fig.width=6}

geneOI <- c("Pax3","Dbx1","Dbx2","Irx3","Pax6","Nkx6-1","Olig2","Nkx2-2")

```

Heatmap of the D-V markers


```{r fig.width=4.5, fig.height=2}

results_deseq_metadata <- results_deseq %>%
  separate(Comparison, into = c("constantComp","Day","constantGeneKO","GeneKO","constantvs","constantNT"), remove = FALSE) %>%
  dplyr::select(-starts_with("constant"))


plot_heatmap_KO <- results_deseq_metadata %>% filter(Geneid %in% geneOI & GeneKO %in% c("NT","Eed","Ezh2","Brd8")) %>%
         mutate(Geneid=factor(Geneid, levels=rev(geneOI))) 


hm_plot_dvmarkers <- ggplot(plot_heatmap_KO, aes(x=Day,y=Geneid)) +
  geom_tile(color="white", aes(fill= log2FoldChange)) +
  scale_fill_continuous_divergingx(palette = 'RdBu', rev=TRUE, mid = 0,
                       name="log2 fold change relative to NT") +
  facet_grid( ~ GeneKO, scales="free_y") +
  ggtitle("Screen hits") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))


ggsave(paste0(workingdir,outdir,"Heatmap_DV_markers_PRC-Brd8KO.pdf"), plot=hm_plot_dvmarkers,
             width=4.5, height=2, units="in", useDingbats=FALSE)

hm_plot_dvmarkers

```





### heatmap of the temporal progression hits

```{r fig.width=4.5, fig.height=2}

geneOI <- c("E2f7","Foxb1","Sox6","Rfx4","Nfia")


```



Space time vis for original RNAseq

With ggplot to place the cell types in the Y axis 



```{r fig.width=10, fig.height=2}
# make a heatmap of CaTS-RNA: this heatmap filters rows of genes with sd zero
# filter genes
vsd_hm <- count_vsd_ave %>%
  filter(X %in% geneOI) %>%
  column_to_rownames("X") %>%
  dplyr::select(starts_with("WT"))

dim(vsd_hm)

vsd_hm_z <- t(scale(t(vsd_hm))) 

# order the columns
vsd_hm_z <- vsd_hm_z[,sorted_WTDayGate]

# metadata for the heatmap
genecolData_first <- data.frame(Sample_ID = colnames(vsd_hm_z))
genecolData_first <- genecolData_first %>% 
  separate(Sample_ID,into=c("Genotype","Day","Gate"), sep="_", remove=FALSE) %>%
  mutate(DayGate=paste(Day,Gate,sep="_"))
genecolData_first <- as.data.frame(unclass(genecolData_first))

phen_data <- genecolData_first %>%
  dplyr::select(c("Sample_ID","DayGate","Day")) %>%
  remove_rownames() %>%
  column_to_rownames("Sample_ID")

ann_color_JD <- list(
  DayGate = c(D5_p1="#abdff4",D5_p2="#f1df9a", D5_pM="#f19aac",
              D7_p1="#55bee8",D7_p2="#e6c444",D7_pM="#e64466",
              D9_p1="#1a91c1",D9_p2="#c19e1a",D9_pM="#c11a3d",
              D11_p1="#0e506b",D11_p2="#6b570e",D11_pM="#7c1127"),
  Day = c(D5="#fadede",D7="#f3aaaa",D9="#e96666",D11="#cf1e1e"))

# Build the annotation for the complex heatmap
colAnn <- HeatmapAnnotation(
    df = phen_data,
    which = 'col', # 'col' (samples) or 'row' (gene) annotation?
    na_col = 'white', # default colour for any NA values in the annotation data-frame, 'ann'
    col = ann_color_JD,
    annotation_height = 0.6,
    annotation_width = unit(1, 'cm'),
    gap = unit(1, 'mm'))

# Annotated heatmap with dplyr::selected colors
hm_colors = colorRampPalette(rev(brewer.pal(n = 11, name = "RdBu")))(100)


  hmap_catsRNA <- Heatmap(vsd_hm_z,
    name = 'Z-score',

    col = hm_colors,

    # row (gene) parameters
      cluster_rows = TRUE,
      show_row_dend = TRUE,
      #row_title = 'Statistically significant genes',
      row_title_side = 'left',
      row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
      row_title_rot = 90,
      show_row_names = TRUE,
      row_names_gp = gpar(fontsize = 12, fontface = 'bold'),
      row_names_side = 'left',
      row_dend_width = unit(25,'mm'),

    # column (sample) parameters
      cluster_columns = FALSE,
      show_column_dend = TRUE,
      column_title = '',
      column_title_side = 'bottom',
      column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
      column_title_rot = 0,
      show_column_names = FALSE,
      column_names_gp = gpar(fontsize = 8),
      column_names_max_height = unit(10, 'cm'),
      column_dend_height = unit(25,'mm'),

    # cluster methods for rows and columns
      clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
      clustering_method_columns = 'ward.D2',
      clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
      clustering_method_rows = 'ward.D2',

    # specify top and bottom annotations
      top_annotation = colAnn)


    ## heatmap of all log2FC whether sig or not 
  results_deseq_subset <- results_deseq %>% 
    separate(Comparison, into = c("constantComp","Day","constantGeneKO","GeneKO","constantvs","constantNT"), remove = FALSE) %>%
      dplyr::select(-starts_with("constant")) %>% 
      filter(GeneKO %in% c("Eed","Ezh2","Brd8")) %>% 
      mutate(GeneKO_day=paste(GeneKO, Day, sep="_"))
     
  sub_wide_log2fc <- results_deseq_subset %>% dplyr::select(Geneid,log2FoldChange, GeneKO_day) %>%
      filter(Geneid %in% geneOI)  %>% # we were just looking for these few genes
      pivot_wider(values_from = log2FoldChange, names_from = GeneKO_day) %>% # this table has 3 columns for the three days with NAs for those genes that are significant at a particular timepoint   
      column_to_rownames("Geneid")

  #row order
    log2fc_matrix_catsfiltered <- sub_wide_log2fc[rownames(vsd_hm),]
    log2fc_matrix_catsfiltered <- as.matrix(log2fc_matrix_catsfiltered)
    
    # color foldchange heatmap
    #color for the fold change heatmap: outliers mapped to the same color 
    hm_colors_fc = colorRamp2(c(-1.9, 0, 1.9), c("#4dac26", "white", "#d01c8b"))
    
    # make a heatmap of log2FC        
    hmap_foldchange <- Heatmap(log2fc_matrix_catsfiltered,
        name = 'log 2 fold change KO: Eed,Ezh2,Brd8',
        col = hm_colors_fc,
        # row (gene) parameters
          cluster_rows = FALSE,
          show_row_dend = TRUE,
          #row_title = 'Statistically significant genes',
          row_title_side = 'left',
          row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
          row_title_rot = 90,
          show_row_names = TRUE,
          row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
          row_names_side = 'left',
          row_dend_width = unit(25,'mm'),
    
        # column (sample) parameters
          cluster_columns = FALSE,
          show_column_dend = TRUE,
          column_title = '',
          column_title_side = 'bottom',
          column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
          column_title_rot = 0,
          show_column_names = TRUE,
          column_names_gp = gpar(fontsize = 8),
          column_names_max_height = unit(10, 'cm'),
          column_dend_height = unit(25,'mm'),
    
        # cluster methods for rows and columns
          clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
          clustering_method_columns = 'ward.D2',
          clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
          clustering_method_rows = 'ward.D2')

draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')    

# print heatmap
pdf(paste0(workingdir,outdir,"Heatmap_ExampleHitsTemporal_KO_PRC_Brd8.pdf"), width = 10, height = 2) 

draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')

dev.off()

```


## Fig: Nr6a1

- Plot genes affected by Nr6a1 with their usual pattern
- Filter properly expressed genes
- average cats-rna
- show any fold change

```{r fig.height=5, fig.width=6.5}


top_comparisons_prep_Nr6a1 <- top_comparisons_prep %>% 
  mutate(GeneKO_day=paste(GeneKO, Day, sep="_")) %>%
  filter(GeneKO %in% c("Nr6a1"))

top_nr6a1_countscheck <- count_cats %>%
  dplyr::select(starts_with("WT")) %>%
  rownames_to_column("geneid") %>%
  filter(geneid %in% top_comparisons_prep_Nr6a1$Geneid) 

top_nr6a1_counts_filter <- top_nr6a1_countscheck %>%
  pivot_longer(names_to = "sampleid", values_to = "rna_counts", starts_with("WT")) %>%
  mutate(zerocounts=case_when(rna_counts==0 ~ "0", rna_counts > 0 ~ "1")) %>%
  mutate(zerocounts=as.numeric(zerocounts)) %>%
  separate(sampleid,into=c("Genotype","Day","Gate","NFIAgate","Rep"), sep="_", remove=FALSE) %>%
  group_by(geneid,Genotype,Day,Gate) %>%
  mutate(condition=paste(Genotype,Day,Gate, sep = "_"),
          conditionzerosums = sum(zerocounts)) %>%
  ungroup() %>%
  dplyr::select(geneid,condition,conditionzerosums) %>% 
  unique() %>% 
  pivot_wider(names_from = condition, values_from = conditionzerosums) %>%
  column_to_rownames("geneid")


# only include genes where at least 1 condition has more than 1 sample >0      
top_nr6a1_counts_filter2 <-  top_nr6a1_counts_filter[rowSums(top_nr6a1_counts_filter <= 1) <= 1, ]

top_Nr6a1_selected <- top_nr6a1_counts_filter2 %>% rownames_to_column("geneid")

# make a heatmap of CaTS-RNA: this heatmap filters rows of genes with sd zero
# filter genes
vsd_hm <- count_vsd_ave %>%
  filter(X %in% top_Nr6a1_selected$geneid) %>%
  column_to_rownames("X") %>%
  dplyr::select(starts_with("WT"))

dim(vsd_hm)

vsd_hm_z1 <- t(scale(t(vsd_hm))) 
nonzero = rowSds(vsd_hm_z1, useNames = TRUE) %>% as.data.frame() %>% rownames_to_column("geneid")
colnames(nonzero) = c("geneid","calculated_rowsds")
nonzero_filtered = nonzero %>% filter(calculated_rowsds != 0) %>% dplyr::select(geneid)
vsd_hm_z <- vsd_hm_z1[nonzero_filtered$geneid,]

# order the columns
vsd_hm_z <- vsd_hm_z[,sorted_WTDayGate]

# metadata for the heatmap
genecolData_first <- data.frame(Sample_ID = colnames(vsd_hm_z))
genecolData_first <- genecolData_first %>% 
  separate(Sample_ID,into=c("Genotype","Day","Gate"), sep="_", remove=FALSE) %>%
  mutate(DayGate=paste(Day,Gate,sep="_"))
genecolData_first <- as.data.frame(unclass(genecolData_first))

phen_data <- genecolData_first %>%
  dplyr::select(c("Sample_ID","Day","DayGate")) %>%
  remove_rownames() %>%
  column_to_rownames("Sample_ID")

ann_color_JD <- list(
  DayGate = c(D5_p1="#abdff4",D5_p2="#f1df9a", D5_pM="#f19aac",
              D7_p1="#55bee8",D7_p2="#e6c444",D7_pM="#e64466",
              D9_p1="#1a91c1",D9_p2="#c19e1a",D9_pM="#c11a3d",
              D11_p1="#0e506b",D11_p2="#6b570e",D11_pM="#7c1127"),
  Day = c(D5="#fadede",D7="#f3aaaa",D9="#e96666",D11="#cf1e1e"))

# Build the annotation for the complex heatmap
colAnn <- HeatmapAnnotation(
    df = phen_data,
    which = 'col', # 'col' (samples) or 'row' (gene) annotation?
    na_col = 'white', # default colour for any NA values in the annotation data-frame, 'ann'
    col = ann_color_JD,
    annotation_height = 0.6,
    annotation_width = unit(1, 'cm'),
    gap = unit(1, 'mm'))

# Annotated heatmap with dplyr::selected colors
hm_colors = colorRampPalette(rev(brewer.pal(n = 11, name = "RdBu")))(100)

set.seed(953)  #For reproduciblity
 
hmap_catsRNA <- Heatmap(vsd_hm_z,
    km=4,
    name = 'Z-score',

    col = hm_colors,

    # row (gene) parameters
      cluster_rows = TRUE,
      show_row_dend = TRUE,
      #row_title = 'Statistically significant genes',
      row_title_side = 'left',
      row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
      row_title_rot = 90,
      show_row_names = TRUE,
      row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
      row_names_side = 'left',
      row_dend_width = unit(25,'mm'),

    # column (sample) parameters
      cluster_columns = FALSE,
      show_column_dend = TRUE,
      column_title = '',
      column_title_side = 'bottom',
      column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
      column_title_rot = 0,
      show_column_names = FALSE,
      column_names_gp = gpar(fontsize = 8),
      column_names_max_height = unit(10, 'cm'),
      column_dend_height = unit(25,'mm'),

    # cluster methods for rows and columns
      clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
      clustering_method_columns = 'ward.D2',
      clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
      clustering_method_rows = 'ward.D2',

    # specify top and bottom annotations
      top_annotation = colAnn)


    ## subset to make a heatmap of log2FC
    # sub_log2fc <- top_comparisons_prep_Nr6a1 %>% dplyr::select(Geneid,log2FoldChange, GeneKO_day) %>%
    #   pivot_wider(values_from = log2FoldChange, names_from = GeneKO_day) # this table has 3 columns for the three days with NAs for those genes that are significant at a particular timepoint 
    # log2fc_matrix_full <- sub_log2fc %>% column_to_rownames("Geneid")
    # log2fc_matrix_catsfiltered <- log2fc_matrix_full[nonzero_filtered$geneid,]
    # log2fc_matrix_catsfiltered <- as.matrix(log2fc_matrix_catsfiltered)
    
     ## subset to make a heatmap of log2FC whether significant or not    
    results_deseq_subset <- results_deseq %>% 
      separate(Comparison, into = c("constantComp","Day","constantGeneKO","GeneKO","constantvs","constantNT"), remove = FALSE) %>%
        dplyr::select(-starts_with("constant")) %>% 
        filter(GeneKO %in% c("Nr6a1")) %>% 
        mutate(GeneKO_day=paste(GeneKO, Day, sep="_"))
       
    sub_wide_log2fc <- results_deseq_subset %>% dplyr::select(Geneid,log2FoldChange, GeneKO_day) %>%
        filter(Geneid %in% nonzero_filtered$geneid)  %>% # we were just looking for these few genes
        pivot_wider(values_from = log2FoldChange, names_from = GeneKO_day) %>% # this table has 3 columns for the three days with NAs for those genes that are significant at a particular timepoint   
        column_to_rownames("Geneid")
  
    #row order
      log2fc_matrix_catsfiltered <- sub_wide_log2fc[rownames(vsd_hm_z),]
      log2fc_matrix_catsfiltered <- as.matrix(log2fc_matrix_catsfiltered)


   #color for the fold change heatmap: outliers mapped to the same color 
    hm_colors_fc = colorRamp2(c(-3, 0, 3), c("#4dac26", "white", "#d01c8b"))
    #col_fun(seq(-3, 3))
    
    # make a heatmap of log2FC        
    hmap_foldchange <- Heatmap(log2fc_matrix_catsfiltered,
        name = paste0('log 2 fold change KO: Nr6a1 subset'),
        col = hm_colors_fc,
        # row (gene) parameters
          cluster_rows = FALSE,
          show_row_dend = TRUE,
          #row_title = 'Statistically significant genes',
          row_title_side = 'left',
          row_title_gp = gpar(fontsize = 12,  fontface = 'bold'),
          row_title_rot = 90,
          show_row_names = FALSE,
          row_names_gp = gpar(fontsize = 5, fontface = 'bold'),
          row_names_side = 'left',
          row_dend_width = unit(25,'mm'),
    
        # column (sample) parameters
          cluster_columns = FALSE,
          show_column_dend = TRUE,
          column_title = '',
          column_title_side = 'bottom',
          column_title_gp = gpar(fontsize = 12, fontface = 'bold'),
          column_title_rot = 0,
          show_column_names = TRUE,
          column_names_gp = gpar(fontsize = 8),
          column_names_max_height = unit(10, 'cm'),
          column_dend_height = unit(25,'mm'),
    
        # cluster methods for rows and columns
          clustering_distance_columns = function(x) as.dist(1 - cor(t(x))),
          clustering_method_columns = 'ward.D2',
          clustering_distance_rows = function(x) as.dist(1 - cor(t(x))),
          clustering_method_rows = 'ward.D2')

draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')    

# print heatmap
pdf(paste0(workingdir,outdir,"Heatmap_subsetNr6a1.pdf"), width = 6.5, height = 5)

set.seed(953)
draw(hmap_catsRNA + hmap_foldchange,
    heatmap_legend_side = 'left',
    annotation_legend_side = 'left',
    row_sub_title_side = 'left')

dev.off()

```
### Fig bubbles and ave

- extract cluster 1
- plot ave with x axis being days and y axis being cell type 
- heatmap for the fold change


```{r}
set.seed(953)
hmap = draw(hmap_catsRNA + hmap_foldchange)
row_order(hmap)

cluster1_index <- row_order(hmap)$`1`

vsd_hm_z_c1 <- vsd_hm_z[cluster1_index,]

log2fc_matrix_catsfiltered_c1 <- log2fc_matrix_catsfiltered[cluster1_index,]

```



```{r}


plot_heatmap_KO_Nr6a1 <- results_deseq_subset %>% filter(Geneid %in% rownames(log2fc_matrix_catsfiltered_c1)) %>%
  mutate(Geneid = factor(Geneid, levels=rev(rownames(log2fc_matrix_catsfiltered_c1))))


```





### with just key genes to highlight 

Space time vis for original RNAseq


Slc1a3 is GLAST

```{r}

nr6a1_genes2highlight <- c("Sox10","Nfib","Bcl11a","Bcan","Slc1a3","Ndrg2","Ptprz1","Lrrtm2","Reln","Aldh1l1")

```


Heatmap ggplot 

```{r fig.width=4, fig.height=3}
nr6a1_genes2highlight


hm_plot_nr <- ggplot(plot_heatmap_KO_Nr6a1 %>% filter(Geneid %in% nr6a1_genes2highlight) , aes(x=Day,y=Geneid)) +
  geom_tile(color="white", aes(fill= log2FoldChange)) +
  scale_fill_continuous_divergingx(palette = 'RdBu', rev=TRUE, mid = 0,
                       name="log2 fold change relative to NT") +
  facet_grid( ~ GeneKO, scales="free_y") +
  ggtitle("Nr6a1 affected subset") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))


ggsave(paste0(workingdir,outdir,"Heatmap_log2fc_subsub_Nr6a1KO.pdf"), plot=hm_plot_nr,
             width=4, height=3, units="in", useDingbats=FALSE)


hm_plot_nr
```




Line plots instead of heatmap for CaTS-RNA

```{r}


count_cats_sub <- count_cats %>% dplyr::select(starts_with("WT")) %>%
  as.data.frame() %>%
  rownames_to_column("geneid") %>%
  filter(geneid %in% nr6a1_genes2highlight) %>%
  pivot_longer(names_to = "sampleid", values_to = "norm_counts", starts_with("WT")) %>%
  separate(sampleid, into=c("Genotype","Day","CellType","NFIAstatus","Rep"), remove = FALSE) %>%
  mutate(Day=factor(Day,levels=c("D5","D7","D9","D11")))

```


```{r}

ggplot(count_cats_sub, aes(x=Day, y=norm_counts, group=CellType)) +
  stat_summary(aes(color=CellType), geom = "line", fun=mean) +
  geom_jitter(aes(fill=CellType), shape=21, size=2, width = 0.25) +
  scale_fill_manual(values = colorgates) +
  scale_color_manual(values = colorgates) +
  facet_wrap( ~ geneid, scales = "free_y") +
  ylab("Normalized RNA counts") +
  theme_bw(base_size = 18)

```

```{r}

# relative to max for ploting the average:

count_cats_sub_rel <- count_cats_sub %>%
  group_by(geneid) %>%
  mutate(rel_counts = norm_counts/max(norm_counts))


```


Average of relative counts and plot

```{r}

#average:

count_cats_sub_relave <- count_cats_sub_rel %>%
  group_by(CellType, Day) %>%
  summarise(ave_rel = mean(rel_counts),
            sd_rel = sd(rel_counts),
            se_rel = sd_rel/sqrt(n()))


```

```{r fig.width=3.7, fig.height=2}

rel_ave_nr6a1sub <- ggplot(count_cats_sub_relave, aes(x=Day, y=ave_rel, group=CellType)) +
  geom_ribbon(aes(ymax=ave_rel+se_rel, ymin=ave_rel-se_rel, fill=CellType), alpha=0.4) +
  geom_line(aes(color=CellType),linewidth=1) +
  #geom_point(aes(fill=CellType), shape=21, size=2, width = 0.25) +
  scale_fill_manual(values = colorgates) +
  scale_color_manual(values = colorgates) +
  expand_limits(y=1) +
  ylab("Relative average RNA counts") +
  theme_bw(base_size = 18)

ggsave(paste0(workingdir,outdir,"Lineplot_ave_relative_subsub_Nr6a1KO.pdf"), plot=rel_ave_nr6a1sub,
             width=3.7, height=2, units="in", useDingbats=FALSE)

rel_ave_nr6a1sub



```


## Nr6a1 known targets

Plot changes (or lack thereof) in Nr6a1 mut.

Import data generated in this script 

```{r}
timepoint=c("D07_","D09_","D11_")
       
dds_sub_counts_list <- lapply(c(1:length(timepoint)), function(x) {
  norm_counts <- read.table(file = paste0(workingdir,outdir,"CountsNormalized_",timepoint[x],"GeneKO_Nr6a1_vs_NT",".txt"))
  norm_counts
})

dds_sub_counts <- do.call(cbind, dds_sub_counts_list)

dds_counts_plot <- dds_sub_counts %>% 
  as.data.frame() %>%
  rownames_to_column("geneid") %>%
  gather(sampleid, counts_norm, starts_with("D"))%>% 
  separate(sampleid,into=c("Day","GeneKO","Rep"), sep="_", remove=FALSE)

colorKOs <- c("#b7b7b7","#ff2e0e")
```


Hox from et al Figure 5 Chang et al 2022

```{r fig.height=4, fig.width=6}

geneOI <- c("Hoxaas3","Hoxc5","Hoxc6","Hoxc8","Hoxc9","Hoxc10","Hoxa11","Hoxa11os","Hoxd12","Hoxa13","Hottip","Hoxb13","Hoxc13","Hoxd13")

```

Bar plots of the known Hox genes affected

```{r fig.width=4.5, fig.height=2}

plot_nr6a1KO_targetgenes <- ggplot(dds_counts_plot %>% filter(geneid %in% geneOI & GeneKO %in% c("NT","Nr6a1")) %>% 
            mutate(geneid=factor(geneid, levels=geneOI)), 
               aes(x=Day,y=counts_norm)) +
          stat_summary(aes(fill=GeneKO),
            fun = mean, geom="bar", alpha=0.8, width=0.6,position=position_dodge(0.6)) +
          geom_point(aes(fill=GeneKO), alpha=0.7, position = position_jitterdodge(jitter.width = 0.2),color="black",shape=21) +
          scale_fill_manual(values=colorKOs) +
          scale_color_manual(values=colorKOs) +
          scale_shape_manual(values=shapes4_fill_manual) +
          facet_wrap(~ geneid, scales = "free_y") +
          theme_bw()
        
# ggsave(paste0(workingdir,outdir,"Barplot_knowntargets_Nr6a1KO.pdf"), plot=plot_nr6a1KO_targetgenes,
#              width=4, height=2, units="in", useDingbats=FALSE)

plot_nr6a1KO_targetgenes



```


Fig 7 genes Chang et al 2022

```{r f}

geneOI <- c("Hoxc6","Hoxa7","Hoxc8","Hoxa9","Hoxc9","Hoxd9","Hoxb6","Hoxb9","Hoxb7","Hoxb8",
            "Hoxa10","Hoxc10","Hoxd10","Hoxa11","Hoxc11","Hoxd11","Hoxa11os","Hotair","Hoxc12","Hoxd12","Hoxb13","Hoxc13","Hoxd13")

```


```{r fig.width=8, fig.height=4.5}

plot_nr6a1KO_targetgenes <- ggplot(dds_counts_plot %>% filter(geneid %in% geneOI & GeneKO %in% c("NT","Nr6a1")) %>% 
            mutate(geneid=factor(geneid, levels=geneOI)), 
               aes(x=Day,y=counts_norm)) +
          stat_summary(aes(fill=GeneKO),
            fun = mean, geom="bar", alpha=0.8, width=0.6,position=position_dodge(0.6)) +
          geom_point(aes(fill=GeneKO), alpha=0.7, position = position_jitterdodge(jitter.width = 0.2),color="black",shape=21) +
          scale_fill_manual(values=colorKOs) +
          scale_color_manual(values=colorKOs) +
          scale_shape_manual(values=shapes4_fill_manual) +
          facet_wrap(~ geneid, scales = "free_y") +
          theme_bw()
        
ggsave(paste0(workingdir,outdir,"Barplot_knowntargets_Nr6a1KO.pdf"), plot=plot_nr6a1KO_targetgenes,
             width=8, height=4.5, units="in", useDingbats=FALSE)

plot_nr6a1KO_targetgenes



```


```{r}
sessionInfo()
```


